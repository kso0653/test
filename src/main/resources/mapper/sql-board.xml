<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="mybatis.boarduk.mapper.BoardMapper">
    <select id="selectBoardList" resultType="mybatis.boarduk.dto.BoardDto">
        <![CDATA[
        SELECT
            board_no,
            board_title,
            board_views,
            to_char(insert_timestamp, 'YYYY.MM.DD HH24:MM') as insert_timestamp
        FROM
            b_board
        WHERE
            is_deleted = 'F'
        ORDER BY board_no DESC
        ]]>
    </select>
    <insert id="insertBoard" parameterType="mybatis.boarduk.dto.BoardDto" useGeneratedKeys="true" keyProperty="boardNo">
        <![CDATA[
        INSERT INTO b_board
            (
                board_title,
                board_contents,
                insert_timestamp,
                board_writer
            )
            VALUES
            (
                #{boardTitle},
                #{boardContents},
                NOW(),
                'admin' --임시 (회원가입 개발 후 변경)
            )
        ]]>
    </insert>
    <insert id="insertBoardFileList" parameterType="mybatis.boarduk.dto.BoardFileDto">
        <![CDATA[
			INSERT INTO b_file
			(
				board_no,
				original_file_name,
				stored_file_path,
				file_size,
				board_writer,
				insert_timestamp
			)
			VALUES
		]]>
        <foreach collection="list" item="item" separator=",">
            (
            #{item.boardNo},
            #{item.originalFileName},
            #{item.storedFilePath},
            #{item.fileSize},
            'admin',
            NOW()
            )
        </foreach>
    </insert>
    <update id="updateViewCount" parameterType="int">
        <![CDATA[
            UPDATE
                b_board
            SET
                board_views = board_views + 1
            WHERE
                board_no = #{boardNo}
        ]]>
    </update>
    <select id="selectBoardDetail" parameterType="int" resultType="mybatis.boarduk.dto.BoardDto">
        <![CDATA[
            SELECT
                board_no,
                board_views,
                board_writer,
                to_char(insert_timestamp, 'YYYY.MM.DD HH24:MM') as insert_timestamp,
                board_title,
                board_contents
            FROM
                b_board
            WHERE
                board_no = #{boardNo}
                AND is_deleted = 'F'
        ]]>
    </select>
    <update id="updateBoard" parameterType="mybatis.boarduk.dto.BoardDto">
        <![CDATA[
            UPDATE
                b_board
            SET
                board_title = #{boardTitle},
                board_contents = #{boardContents},
                updated_timestamp = NOW(),
                board_editor = 'admin'
            WHERE
                board_no = #{boardNo}
        ]]>
    </update>
    <select id="selectBoardFileList" parameterType="int" resultType="mybatis.boarduk.dto.BoardFileDto">
		<![CDATA[
        SELECT
            file_id,
            board_no,
            original_file_name,
            ROUND( CAST(file_size / 1024 as numeric), 2) AS file_size
        FROM
            b_file
        WHERE
            board_no = #{boardNo}
          AND is_deleted = 'F'
        ]]>
	</select>
    <select id="selectBoardFileInformation" parameterType="map" resultType="mybatis.boarduk.dto.BoardFileDto">
		<![CDATA[
        SELECT
            original_file_name,
            stored_file_path,
            file_size
        FROM
            b_file
        WHERE
            file_id = #{fileId}
          AND board_no = #{boardNo}
          AND is_deleted = 'F'
        ]]>
	</select>
    <update id="deleteBoardFile" parameterType="map">
		<![CDATA[
        UPDATE
            b_file
        SET
            is_deleted = 'T',
            updated_timestamp = NOW(),
            board_editor = 'admin'
        WHERE
            file_id = #{fileId}
          AND board_no = #{boardNo}
        ]]>
	</update>
    <update id="deleteBoard" parameterType="int">
        <![CDATA[
        UPDATE
            b_board
        SET
            is_deleted = 'T',
            updated_timestamp = NOW(),
            board_editor = 'admin'
        WHERE
            board_no = #{boardNo}
        ]]>
    </update>
    <select id="searchBoardList" resultType="mybatis.boarduk.dto.BoardDto">

        SELECT board_no,
               board_title,
               board_views,
               to_char(insert_timestamp, 'YYYY.MM.DD HH24:MM') as insert_timestamp
          FROM b_board
         WHERE is_deleted = 'F'
        <if test="searchTitle!=null and !searchTitle.equals('')">
           AND board_title LIKE CONCAT('%', #{searchTitle},'%')
        </if>
--         and board_no <![CDATA[ <  ]]> 5
         ORDER BY board_no DESC
    </select>
</mapper>